{"objects":[{"jobObject":{"JobType":".TransformationJob","id":1979,"revision":86,"created":1639402736398,"timestamp":1639402736398,"components":{"1985":{"id":1985,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":487,"y":234,"width":32,"height":32,"inputConnectorIDs":[2381],"outputConnectorIDs":[1999],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Only Mag >= 2"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mag"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than or equal to"},"4":{"slot":4,"type":"STRING","value":"2"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"1986":{"id":1986,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":128170095,"x":583,"y":234,"width":32,"height":32,"inputConnectorIDs":[1999],"outputConnectorIDs":[1997],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Quake renamer"}}}},"visible":true},"2":{"slot":2,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"},"2":{"slot":2,"type":"STRING","value":"ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"utc"},"2":{"slot":2,"type":"STRING","value":"UTC"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"depth"},"2":{"slot":2,"type":"STRING","value":"depth"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"mag"},"2":{"slot":2,"type":"STRING","value":"magnitude"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"geo_from_wkb"},"2":{"slot":2,"type":"STRING","value":"geo"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"1987":{"id":1987,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":711,"y":314,"width":32,"height":32,"inputConnectorIDs":[3012,1997],"outputConnectorIDs":[1993],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Spatial Join"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Quake renamer"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"q"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"To LINESTRING"},"2":{"slot":2,"type":"STRING","value":"pb"},"3":{"slot":3,"type":"STRING","value":"Full"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1 = 1"},"2":{"slot":2,"type":"STRING","value":"q_Full_pb"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"q.id"},"2":{"slot":2,"type":"STRING","value":"q_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"q.utc"},"2":{"slot":2,"type":"STRING","value":"UTC"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"q.depth"},"2":{"slot":2,"type":"STRING","value":"depth"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"q.magnitude"},"2":{"slot":2,"type":"STRING","value":"magnitude"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"q.geo"},"2":{"slot":2,"type":"STRING","value":"q_geo"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"pb.id"},"2":{"slot":2,"type":"STRING","value":"pb_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"pb.name"},"2":{"slot":2,"type":"STRING","value":"name"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"pb.type"},"2":{"slot":2,"type":"STRING","value":"type"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"pb.geo"},"2":{"slot":2,"type":"STRING","value":"pb_geo"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"1988":{"id":1988,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":839,"y":314,"width":32,"height":32,"inputConnectorIDs":[1993],"outputConnectorIDs":[1995],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Spatial Derivations"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ROUND(ST_DISTANCE(`q_geo`, `pb_geo`) / 1000)"},"2":{"slot":2,"type":"STRING","value":"km_to_boundary"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"`utc`"},"2":{"slot":2,"type":"STRING","value":"ts_utc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ST_X(`q_geo`)"},"2":{"slot":2,"type":"STRING","value":"longitude"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ST_Y(`q_geo`)"},"2":{"slot":2,"type":"STRING","value":"latitude"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"1"},"2":{"slot":2,"type":"STRING","value":"counter"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"FORMAT_DATETIME('%Y-%m-%d', `utc`)"},"2":{"slot":2,"type":"STRING","value":"yyyymmdd"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"CAST(\n  CASE\n    WHEN `depth` <= 0 THEN 0\n    ELSE ROUND(`depth`, -1)\n  END\n  AS STRING)"},"2":{"slot":2,"type":"STRING","value":"depth_km_string"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"1989":{"id":1989,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":2139809017,"x":967,"y":314,"width":32,"height":32,"inputConnectorIDs":[1995],"outputConnectorIDs":[1996],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rank prox"}}}},"visible":true},"2":{"slot":2,"name":"Include input columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Partition Data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"q_id"}}}},"visible":true},"4":{"slot":4,"name":"Ordering within partitions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"km_to_boundary"},"2":{"slot":2,"type":"STRING","value":"Asc"}}}},"visible":true},"5":{"slot":5,"name":"Functions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Row Number"},"2":{"slot":2,"type":"STRING","value":"rn"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"1990":{"id":1990,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":1095,"y":314,"width":32,"height":32,"inputConnectorIDs":[1996],"outputConnectorIDs":[3790],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Only Closest"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rn"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"1"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"2013":{"id":2013,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":256,"y":240,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2294],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_quakes_ext"}}}},"visible":true},"2":{"slot":2,"name":"Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_quakes_ext"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"utc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"depth"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"mag"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"geo"}}}},"visible":true},"5":{"slot":5,"name":"Dataset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Project","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Include Partition Time","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"8":{"slot":8,"name":"Partition Time Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"exportMappings":{},"activationStatus":"ENABLED"},"2293":{"id":2293,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":368,"y":240,"width":32,"height":32,"inputConnectorIDs":[2294],"outputConnectorIDs":[2381],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"To POINT"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ST_GEOGFROM(`geo`)"},"2":{"slot":2,"type":"STRING","value":"geo_from_wkb"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"2625":{"id":2625,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":432,"y":416,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2943],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_boundaries_ext"}}}},"visible":true},"2":{"slot":2,"name":"Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_boundaries_ext"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"int64_field_0"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"string_field_1"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"string_field_2"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"string_field_3"}}}},"visible":true},"5":{"slot":5,"name":"Dataset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Project","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Include Partition Time","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"8":{"slot":8,"name":"Partition Time Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"exportMappings":{},"activationStatus":"ENABLED"},"2942":{"id":2942,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":576,"y":416,"width":32,"height":32,"inputConnectorIDs":[2943],"outputConnectorIDs":[3012],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"To LINESTRING"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"`int64_field_0`"},"2":{"slot":2,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"`string_field_1`"},"2":{"slot":2,"type":"STRING","value":"name"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"`string_field_2`"},"2":{"slot":2,"type":"STRING","value":"type"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ST_GEOGFROM(`string_field_3`)"},"2":{"slot":2,"type":"STRING","value":"geo"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"3313":{"id":3313,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":335239555,"x":1472,"y":320,"width":32,"height":32,"inputConnectorIDs":[3795],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rewrite agg_qb"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"agg_qb"}}}},"visible":true},"6":{"slot":6,"name":"Target Dataset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"100":{"slot":100,"name":"Target Project","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"3778":{"id":3778,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":1216,"y":320,"width":32,"height":32,"inputConnectorIDs":[3790],"outputConnectorIDs":[3780],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"More spatial calculations"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CASE WHEN `km_to_boundary` > 1000 THEN 'Intraplate'\n     ELSE INITCAP(COALESCE(NULLIF(`type`, ''), 'boundary'))\nEND"},"2":{"slot":2,"type":"STRING","value":"boundary_type"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CASE WHEN `km_to_boundary` > 1000 THEN 'Intraplate'\n     ELSE CAST(`pb_id` AS STRING)\nEND"},"2":{"slot":2,"type":"STRING","value":"boundary_id_coalesce"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CASE WHEN `km_to_boundary` > 1000 THEN 'Intraplate'\n     ELSE `name`\nEND"},"2":{"slot":2,"type":"STRING","value":"boundary_name_coalesce"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"},"3779":{"id":3779,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":128170095,"x":1344,"y":320,"width":32,"height":32,"inputConnectorIDs":[3780],"outputConnectorIDs":[3795],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rename 0"}}}},"visible":true},"2":{"slot":2,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"q_id"},"2":{"slot":2,"type":"STRING","value":"event_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"yyyymmdd"},"2":{"slot":2,"type":"STRING","value":"yyyymmdd"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"depth_km_string"},"2":{"slot":2,"type":"STRING","value":"depth_km"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"magnitude"},"2":{"slot":2,"type":"STRING","value":"magnitude"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"longitude"},"2":{"slot":2,"type":"STRING","value":"longitude"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"latitude"},"2":{"slot":2,"type":"STRING","value":"latitude"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"boundary_type"},"2":{"slot":2,"type":"STRING","value":"location_type"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"boundary_name_coalesce"},"2":{"slot":2,"type":"STRING","value":"boundary_name"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"km_to_boundary"},"2":{"slot":2,"type":"STRING","value":"km_to_boundary"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"counter"},"2":{"slot":2,"type":"STRING","value":"counter"}}}},"visible":true}},"exportMappings":{},"activationStatus":"ENABLED"}},"connectors":{"1993":{"id":1993,"sourceID":1987,"targetID":1988},"1995":{"id":1995,"sourceID":1988,"targetID":1989},"1996":{"id":1996,"sourceID":1989,"targetID":1990},"1997":{"id":1997,"sourceID":1986,"targetID":1987},"1999":{"id":1999,"sourceID":1985,"targetID":1986},"2294":{"id":2294,"sourceID":2013,"targetID":2293},"2381":{"id":2381,"sourceID":2293,"targetID":1985},"2943":{"id":2943,"sourceID":2625,"targetID":2942},"3012":{"id":3012,"sourceID":2942,"targetID":1987},"3780":{"id":3780,"sourceID":3778,"targetID":3779},"3790":{"id":3790,"sourceID":1990,"targetID":3778},"3795":{"id":3795,"sourceID":3779,"targetID":3313}},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1639402718310,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"1980":{"id":1980,"x":592,"y":113,"width":403,"height":40,"text":"This is an example of a **spatial join** in a Matillion ETL data Transformation Job","colour":"00ce4f"},"1981":{"id":1981,"x":359,"y":364,"width":261,"height":106,"text":"Boundary line segments from Shapefile","colour":"00ce4f"},"1982":{"id":1982,"x":196,"y":168,"width":218,"height":136,"text":"Point events","colour":"00ce4f"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"id":1979,"name":"example PB2002 transformation","description":"","type":"TRANSFORMATION","tag":"9910e436-84ed-4dbe-a992-c0e8f5f03814"},"path":["matillion-examples","spatial"]}],"version":"1.48.7","environment":"bigquery"}