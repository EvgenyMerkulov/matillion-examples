{"objects":[{"metadata":{"identifier":{"packageName":"matillionexamples","name":"Check Network Access","revision":1,"type":"DYNAMIC"},"rootJobReference":{"name":"Check Network access","type":"ORCHESTRATION","parameterMetadata":[{"slot":2,"variableName":"p_address","variableType":"SCALAR","displayName":"Address","description":"An IP address or hostname","defaultValue":[],"defaultValueType":null,"required":true},{"slot":3,"variableName":"p_port_number","variableType":"SCALAR","displayName":"Port_number","description":"A numeric port number","defaultValue":[],"defaultValueType":null,"required":true}]},"orchestrationJobs":["Check Network access"],"transformationJobs":[],"imageMetadata":{"componentIcon":"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAFQUlEQVR42tVXWUhVaxQ+Kvhg5IAIOYA4kOY8ZCoOSBKiRo6goFbgGKJk6ItCIpaKIiSKhqkvJqaWCkppzoKJE+aDiuJUmPOUpqYv6/L9sHd7n31O2b3BpYfFOf/8/ev/1rfWlp2fn9P/abK/CsDq6irV1NRQUlIS+fj4kKOjI1lbW5O7uzvFxMRQaWkpzc/P/3kAQ0NDFBwcTA4ODpSZmUnv3r2jxcVFqqqqooyMDFpeXqbu7m7Kzc1lYLy9vam5uZnOzs7+G4CtrS26d+8e27C3t1cyXltbywDJ94+NjVFQUBDdunXrlx5RCmBqaoq5t6Kigr5//65wjjIAnL169Yp0dXXp7du3vwdgYmKCrl27Rh8+fJCMbWxsUHV1NT148IBu3LhBFhYWFBsby94fzyKcm5iYSDKZjNTV1amlpeViAD5//swOHxkZkRAwPj6eeQW3bmtro4KCAkpISKDOzk568uQJOTs7U3h4OM3OzlJ9fT2pqKgwALBLly6xp/kpAJDG39+fLRb2v3//nt0UNz89PRU9QVZWlmg9gNnY2NDly5f5wznDHl+/flUOoKmpiUJDQ0UTsKG9vT3Nzc0p5IAQAOzo6IicnJwkh3OWk5OjGACIhoXT09Osvbu7ywBZWVnRysqKUhLKA0hOTlZ6OLhgZGTE9pYAGBgYoDt37vADCD0sioiIUHg4bgoOgBecWxsaGkTvzpm2tjY9evSIlpaWmG48f/5cCuDhw4fsRlwbooPFISEhksPBeHNzczYHv5aWlpSenk46Ojqig/X19cnFxYUJllAj/Pz8pAAQUogArp2WlkYpKSm0ubkpOhxqB5GBSHE6sLOzQ3p6evzBiJTKykrmJYTy7du3+fUgsampKa8tMo696BRKp5ubG3369El0OLiAzbGxUIgAFAfDA0+fPhUJFw6El4R9eN6FhYUfAEAKxD6EBIZBExMTJqNcH6yoqIgdxrWfPXvGiAv9b2xspJKSEiY+wjUwhOXk5CTfhkeQX3gAUDdNTU3y9fXlTUNDQ9SGXb16lRnXxsYAyrXBCUNDQ8k6LS0t8vLy4ttXrlyhvr6+HwDgUhBJ6G54hHM1Z62trRQXF6c0F8BDiAx50iKUDw4O+DYyK6eKPAnNzMzo+PiYnwQ3jY+Pizb69u0b7055AJBqXEKeN9zzCvvgKY7cPACEBpIQ18Z7ZmdnS26DHIENUZiUl5ez+H79+jUDBh5gzuHhIXV1ddHg4CADiQKGW7+3t8ckWRKGhYWFlJeXxw+sr6+ziULXCaMhNTWVsdvAwIDu379PHz9+ZGMQG/QL1Q9AuLVv3rxh2VMCAOy0tbUVhQs8AOVSlssVSfHdu3clSojQ5MahIfCOwmQE2YWcCt/cw8OD6urqLgwAgiYPICoqio2BO0jZwkuKAMzMzLD33d/f5/u+fPnCYr24uFhSGSkCAAWVB1BWVsbW3rx5k9rb239ekMBdeFOhKkJqo6OjmYJ1dHTwNYEQAOaPjo6y6DE2NiZVVVVSU1Nje52cnFB+fj6rnH9ZEQEp4vTx48eSyRAPjIFkqBtQvLi6urKNEQUo1ZHCAQZhuba2xta9fPmSrl+/ziLgQjUh0mtAQAALMaBXND48PMwyaFhYGPX09EiSFucVuB9PCEC/VRVDlFBceHp6sgr5d6tiCBLAocbY3t7+9x8mKKnt7OwoMjKS+vv7JTWhPABUVPAcNARi9auPkwt9GeEZ8LaBgYEs+aDyBUcQ81BQ1Aj4Dx0BUVELyBeff+zjFCGK8u3FixeM2VBPSDIqZ2TVv+7r+B97A9/tuPnBOwAAAABJRU5ErkJggg==","smallIcon":"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACJUlEQVR42qVTS0uqURT9MEf2E/wBQb/Bof9ADBF0rqADsVAEKR+V+UgIURyYCdlESUhFAglDJUTQkQMNceIjREmJUicr9r5UeLvdO7iDwz6vvfba66wjrFYr/M8Qft+YTCaIRCIIBAKw2WwwGo3w+Xw4OzvDcDj8O0ChUIDX68V4POZ1o9HA7e0tz6fTKfx+P66urv4MkMvlkE6nPxNPTk6wt7cHvV7P84eHBzgcDohEIsTj8XWAwWCA09NT3ri8vEQymcRyuVxjcHBwgI2NDQiCAIlEgna7/QVA/c5mM+zu7iIcDn+iV6tV3NzccAGpVMrJYrEYOzs7ODw8/AKgvinK5XLU63Wek5AWiwUGgwFbW1vY3NyETqeD1WrFRw6xFN7e3nB8fMzCud1ujs1mE9FoFPf391AqlVAoFMhkMnzm8XgwGo24QL/fh/Dy8gKNRoNYLAa1Ws2RgEwmE5xOJwtpt9uZDZ1ptVoGJza9Xm+9BVKb4mKxYA9ks1kWlZLn8zkeHx+ZAd0JBoN4fX39BXB0dMSbiUQCrVaL58SMDERAz8/PUKlULCK1Q+drItIbX19fc2Wi2+12vxlpe3ubAWQyGUqlEvL5/LqRqI1Op8O0QqEQU6XnJfMQE5fLBbPZjGKxyJ745kSqTq3c3d19rsmdFxcXDEp7tVoN+/v73N6Pn4mSqBopTaqTWOfn5/zUqVTq37/xYzw9PaFSqaBcLrMTf7r3DpNFOA7vCw7qAAAAAElFTkSuQmCC"},"description":"Check Network Access","helpHtml":"<div class=\"mtln\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAFQUlEQVR42tVXWUhVaxQ+Kvhg5IAIOYA4kOY8ZCoOSBKiRo6goFbgGKJk6ItCIpaKIiSKhqkvJqaWCkppzoKJE+aDiuJUmPOUpqYv6/L9sHd7n31O2b3BpYfFOf/8/ev/1rfWlp2fn9P/abK/CsDq6irV1NRQUlIS+fj4kKOjI1lbW5O7uzvFxMRQaWkpzc/P/3kAQ0NDFBwcTA4ODpSZmUnv3r2jxcVFqqqqooyMDFpeXqbu7m7Kzc1lYLy9vam5uZnOzs7+G4CtrS26d+8e27C3t1cyXltbywDJ94+NjVFQUBDdunXrlx5RCmBqaoq5t6Kigr5//65wjjIAnL169Yp0dXXp7du3vwdgYmKCrl27Rh8+fJCMbWxsUHV1NT148IBu3LhBFhYWFBsby94fzyKcm5iYSDKZjNTV1amlpeViAD5//swOHxkZkRAwPj6eeQW3bmtro4KCAkpISKDOzk568uQJOTs7U3h4OM3OzlJ9fT2pqKgwALBLly6xp/kpAJDG39+fLRb2v3//nt0UNz89PRU9QVZWlmg9gNnY2NDly5f5wznDHl+/flUOoKmpiUJDQ0UTsKG9vT3Nzc0p5IAQAOzo6IicnJwkh3OWk5OjGACIhoXT09Osvbu7ywBZWVnRysqKUhLKA0hOTlZ6OLhgZGTE9pYAGBgYoDt37vADCD0sioiIUHg4bgoOgBecWxsaGkTvzpm2tjY9evSIlpaWmG48f/5cCuDhw4fsRlwbooPFISEhksPBeHNzczYHv5aWlpSenk46Ojqig/X19cnFxYUJllAj/Pz8pAAQUogArp2WlkYpKSm0ubkpOhxqB5GBSHE6sLOzQ3p6evzBiJTKykrmJYTy7du3+fUgsampKa8tMo696BRKp5ubG3369El0OLiAzbGxUIgAFAfDA0+fPhUJFw6El4R9eN6FhYUfAEAKxD6EBIZBExMTJqNcH6yoqIgdxrWfPXvGiAv9b2xspJKSEiY+wjUwhOXk5CTfhkeQX3gAUDdNTU3y9fXlTUNDQ9SGXb16lRnXxsYAyrXBCUNDQ8k6LS0t8vLy4ttXrlyhvr6+HwDgUhBJ6G54hHM1Z62trRQXF6c0F8BDiAx50iKUDw4O+DYyK6eKPAnNzMzo+PiYnwQ3jY+Pizb69u0b7055AJBqXEKeN9zzCvvgKY7cPACEBpIQ18Z7ZmdnS26DHIENUZiUl5ez+H79+jUDBh5gzuHhIXV1ddHg4CADiQKGW7+3t8ckWRKGhYWFlJeXxw+sr6+ziULXCaMhNTWVsdvAwIDu379PHz9+ZGMQG/QL1Q9AuLVv3rxh2VMCAOy0tbUVhQs8AOVSlssVSfHdu3clSojQ5MahIfCOwmQE2YWcCt/cw8OD6urqLgwAgiYPICoqio2BO0jZwkuKAMzMzLD33d/f5/u+fPnCYr24uFhSGSkCAAWVB1BWVsbW3rx5k9rb239ekMBdeFOhKkJqo6OjmYJ1dHTwNYEQAOaPjo6y6DE2NiZVVVVSU1Nje52cnFB+fj6rnH9ZEQEp4vTx48eSyRAPjIFkqBtQvLi6urKNEQUo1ZHCAQZhuba2xta9fPmSrl+/ziLgQjUh0mtAQAALMaBXND48PMwyaFhYGPX09EiSFucVuB9PCEC/VRVDlFBceHp6sgr5d6tiCBLAocbY3t7+9x8mKKnt7OwoMjKS+vv7JTWhPABUVPAcNARi9auPkwt9GeEZ8LaBgYEs+aDyBUcQ81BQ1Aj4Dx0BUVELyBeff+zjFCGK8u3FixeM2VBPSDIqZ2TVv+7r+B97A9/tuPnBOwAAAABJRU5ErkJggg==\"><h3>Check Network Access</h3><p style='white-space: pre-line; word-wrap: break-word;'>Check Network Access</p><h3>Properties</h3><table><tbody><tr><th>Property</th><th>Type</th><th>Description</th></tr><tr><td>Address</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>An IP address or hostname</td></tr><tr><td>Port_number</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>A numeric port number</td></tr></tbody></table></div>","created":1544452917641},"orchestrationJobs":{"Check Network access":{"id":-2,"revision":2,"created":1544452779682,"timestamp":1544452779682,"components":{"372":{"id":372,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[376],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"373":{"id":373,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":143,"y":3,"width":32,"height":32,"inputConnectorIDs":[376],"outputSuccessConnectorIDs":[375],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Log"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"test -z \"${p_address}\" && { echo \"Address must be specified\"; exit 99; }\n\ntest -z \"${p_port_number}\" && { echo \"Port must be specified\"; exit 99; }\n\necho \"Attempting to connect to ${p_address}:${p_port_number}\"\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"374":{"id":374,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":289,"y":3,"width":32,"height":32,"inputConnectorIDs":[375],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Test connectivity"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# Try to connect\n\nnc -z -w 5 -v \"${p_address}\" \"${p_port_number}\"\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"375":{"id":375,"sourceID":373,"targetID":374}},"failureConnectors":{},"unconditionalConnectors":{"376":{"id":376,"sourceID":372,"targetID":373}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"370":{"id":370,"x":84,"y":-60,"width":112,"height":105,"text":"Check and log the parameters supplied","colour":"e6e63c"},"371":{"id":371,"x":246,"y":-58,"width":109,"height":105,"text":"Check connectivity","colour":"e6e63c"}},"variables":{"p_address":{"definition":{"name":"p_address","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"p_port_number":{"definition":{"name":"p_port_number","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}}},"transformationJobs":{}},{"metadata":{"identifier":{"packageName":"matillionexamples","name":"Stage to Hub","revision":1,"type":"DYNAMIC"},"rootJobReference":{"name":"Stage to EDW - Hub","type":"ORCHESTRATION","parameterMetadata":[{"slot":2,"variableName":"jv_schema","variableType":"SCALAR","displayName":"Schema","description":"The Schema Name","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":3,"variableName":"jv_database","variableType":"SCALAR","displayName":"Database","description":"The Database Name","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":4,"variableName":"jv_record_source","variableType":"SCALAR","displayName":"Record Source","description":"Name of source system","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":5,"variableName":"jv_table_name_stub","variableType":"SCALAR","displayName":"DV Name Stub","description":"Stub name of Hub (e.g. \"dummy\" --> h_dummy, s_dummy and e_dummy)","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":6,"variableName":"jv_staging_view_name","variableType":"SCALAR","displayName":"Staging object name","description":"Name of the staging view or table","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":7,"variableName":"gv_business_key","variableType":"GRID","displayName":"Business key columns","description":"List of business key columns","defaultValue":[{"values":{"1":""}}],"defaultValueType":null,"required":true}]},"orchestrationJobs":["Stage to EDW - Hub"],"transformationJobs":[],"imageMetadata":{"componentIcon":"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC9klEQVR42uWXW0gUYRTHN4roqaCeInrpLakIKyF6WTPJwjIvc9mLslmBGt3QCEFDKUVJpKSiC5KpmfmQYlZWFLUpJNKm9pAoKD5Eaunmzs7OXmY7nfmmHV0zmprdeagPfg9zvtlz/nvmzDnfGAwqFkVRK0wmKhFJUgv+Zo0hEotl2QTGRE8j8If4GBOTpzX+IsZMj1HZ+ZBS1AMpJQPqOOuAjJxyIsJqTVv919FTs1JXSf8mtaAVkssnCfl1U/DQwUPhHadiO3pTtpW0zNr2F/XKmWCYPVrSv1YW0KY4rm53QhBEuPbUpdhKW2Rbo52bFVDsIAJoM7333xTQ8ZaH4mYnoQED6y5gIXQV0NzNQc71KcLlxzP/YQ3oIkBqp/MFVLZOg9MTgJpHM4qt+K6T2GqfuyIuYDE6cWXkVkBy2bjiXA1pJ+tDjWi9xllAnyKOLFlAZx5Sh9UmB2eZWxEcSMx5mqXLQmCASmXwYKC5ewQTbZIyaIjWstlsy0ICKDMVZ9B76SbAYrEsZ010k1SMiDCPObM/zO5BnpnN6es0C0BH7RYrBVfOJUL9hXhV1FYkwOGD6Vgb9DDWwVItr+FKFBBsqIoH7lXMz9g3yCywZ6/bTrKDx7Odmjvhkxs7wpzzDhb8M30Q/OYjBLgBcL+zht0z1BYbuVYcJuD1ZhB9k8gECKOXwDt2FUSRAzHgBK4rLvoC3D2JpO/7P3fitZx+YagE/BMPcG+3DhnAZx7gh4kIURgD78cm4N/noX2jTo9AysKbXeCb6AAxyCuHEb+rH9xdW/XIwCYigOvaRuqB788G/3Q3ESEMl0ZfgGewUA42WqPYhA9niM07Uq1DBrDSA95P5PWTCtE3fh/fgK94LYC7d190BHTOr4GeJAzcRopR9IyA/8sL4Psyw+4ZbN2iXcCPgeOuKkoC18uYhbvhL2i5aAwdSGI1zgLqtOQo90gaFBxLUcWJ3AMkOA6xe9L3peaBhIcLGh3eRhrVgiep40ajccnvfH8HVk4hMqxrf1kAAAAASUVORK5CYII=","smallIcon":"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABnklEQVR42mNgQANhkWEBEZFhi8Mjw5agY6BcPAM+kJaWxhqaVPLDr+nO/6LZD/9Hdt//H9Zx/3/pvEf//Zru/g9Jq/8XGhoqgdOA6OhovpD05v8+ba/+H7359X/Rgnf/02a8/X/h4XewWHD2pP9RUcGqRBtw+u73/8dvfSPfgNoV78GuIMuAg1e//i+c/+5/6vS3YJcQZQAQMIbFpd0ILFzyP7BwGQYOi89+7uvry4U3JqKiogQjI0OdQBgafVth/MjISHEGQiA0OlQ3IiqsKiwirCY8MnQ/EJ+GsqsjIiLM8Wp2cHBgyc0IeH18idn/08tMgdgMik3/n1xq9r8sz+8bMB0I4Q3EjiqP/58Pav3/djn9/+9PF////nz1/7cr2WCxGa0uhGMBZsCPB5P+/3yx4f+3q3n/v54NId2Az0ct/n+/3fL/1/sT/388WUiGC54u/f/j0ez/P+5P+P/z5WbiDAAGEGdtkc8fsAsOG/3/fqPi//ebNf+/HDUHG9BT4wE0IEgeb0wAs2xxWnLQxcxUVJyWEnQxPDK8HV09AEQuW/6TGUZmAAAAAElFTkSuQmCC"},"description":"Takes data from a staging view (or table) and populates a Data Vault 2.0 Hub, Satellite and Error table","helpHtml":"<div class=\"mtln\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC9klEQVR42uWXW0gUYRTHN4roqaCeInrpLakIKyF6WTPJwjIvc9mLslmBGt3QCEFDKUVJpKSiC5KpmfmQYlZWFLUpJNKm9pAoKD5Eaunmzs7OXmY7nfmmHV0zmprdeagPfg9zvtlz/nvmzDnfGAwqFkVRK0wmKhFJUgv+Zo0hEotl2QTGRE8j8If4GBOTpzX+IsZMj1HZ+ZBS1AMpJQPqOOuAjJxyIsJqTVv919FTs1JXSf8mtaAVkssnCfl1U/DQwUPhHadiO3pTtpW0zNr2F/XKmWCYPVrSv1YW0KY4rm53QhBEuPbUpdhKW2Rbo52bFVDsIAJoM7333xTQ8ZaH4mYnoQED6y5gIXQV0NzNQc71KcLlxzP/YQ3oIkBqp/MFVLZOg9MTgJpHM4qt+K6T2GqfuyIuYDE6cWXkVkBy2bjiXA1pJ+tDjWi9xllAnyKOLFlAZx5Sh9UmB2eZWxEcSMx5mqXLQmCASmXwYKC5ewQTbZIyaIjWstlsy0ICKDMVZ9B76SbAYrEsZ010k1SMiDCPObM/zO5BnpnN6es0C0BH7RYrBVfOJUL9hXhV1FYkwOGD6Vgb9DDWwVItr+FKFBBsqIoH7lXMz9g3yCywZ6/bTrKDx7Odmjvhkxs7wpzzDhb8M30Q/OYjBLgBcL+zht0z1BYbuVYcJuD1ZhB9k8gECKOXwDt2FUSRAzHgBK4rLvoC3D2JpO/7P3fitZx+YagE/BMPcG+3DhnAZx7gh4kIURgD78cm4N/noX2jTo9AysKbXeCb6AAxyCuHEb+rH9xdW/XIwCYigOvaRuqB788G/3Q3ESEMl0ZfgGewUA42WqPYhA9niM07Uq1DBrDSA95P5PWTCtE3fh/fgK94LYC7d190BHTOr4GeJAzcRopR9IyA/8sL4Psyw+4ZbN2iXcCPgeOuKkoC18uYhbvhL2i5aAwdSGI1zgLqtOQo90gaFBxLUcWJ3AMkOA6xe9L3peaBhIcLGh3eRhrVgiep40ajccnvfH8HVk4hMqxrf1kAAAAASUVORK5CYII=\"><h3>Stage to Hub</h3><p style='white-space: pre-line; word-wrap: break-word;'>Takes data from a staging view (or table) and populates a Data Vault 2.0 Hub, Satellite and Error table</p><h3>Properties</h3><table><tbody><tr><th>Property</th><th>Type</th><th>Description</th></tr><tr><td>Schema</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>The Schema Name</td></tr><tr><td>Database</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>The Database Name</td></tr><tr><td>Record Source</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>Name of source system</td></tr><tr><td>DV Name Stub</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>Stub name of Hub (e.g. &quot;dummy&quot; --&gt; h_dummy, s_dummy and e_dummy)</td></tr><tr><td>Staging object name</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>Name of the staging view or table</td></tr><tr><td>Business key columns</td><td>Grid</td><td style='white-space: pre-line; word-wrap: break-word;'>List of business key columns</td></tr></tbody></table></div>","created":1636036547617},"orchestrationJobs":{"Stage to EDW - Hub":{"id":-2,"revision":12,"created":1636036205113,"timestamp":1636036205113,"components":{"4351":{"id":4351,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":356330947,"x":-240,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4408],"outputSuccessConnectorIDs":[4406],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Staging Metadata"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${jv_database}"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${jv_schema}"}}}},"visible":true,"status":{},"columnNames":[]},"5":{"slot":5,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"gv_viewcolumns"}}}},"visible":true,"status":{},"columnNames":[]},"6":{"slot":6,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Name"}}}},"visible":true,"status":{},"columnNames":[]},"7":{"slot":7,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${jv_staging_view_name}"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4395":{"id":4395,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-496,"y":-16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[4410],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4396":{"id":4396,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":176,"y":-16,"width":32,"height":32,"inputConnectorIDs":[10515],"outputSuccessConnectorIDs":[4404],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Hub DDL"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${jv_database}\".\"${jv_schema}\".\"h_${jv_table_name_stub}\"\n(\n\t\"hashkey\"             VARCHAR(64)   NOT NULL UNIQUE,\n    ${prvt_bkddl}\n\t\"load_timestamp\"      TIMESTAMP_NTZ NOT NULL,\n\t\"record_source\"       VARCHAR(64)   NOT NULL,\n  CONSTRAINT bk_h_dummy UNIQUE (${prvt_sortedcolnames})\n)"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4397":{"id":4397,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-112,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4406],"outputSuccessConnectorIDs":[10511],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Metadata Prep"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# Update prvt_bkddl to the business key DDL \n# Update prvt_sortedcolnames to the sorted list of business key columns\n# -----------------------------------------\n\ng0 = [x[0].strip().strip('\"') for x in context.getGridVariable('gv_business_key')]\n\nbkcols = ['\"' + x + '\"' for x in sorted(g0)]\n\nprint(\"Business key columns: %s\" % bkcols)\n\noutddl = \"\"\nsortedcolnames = \"\"\n\nfor c in bkcols:\n  outddl = outddl + c + \" VARCHAR(128) NOT NULL,\"\n  sortedcolnames = sortedcolnames + \",\" + c\n\nsortedcolnames = sortedcolnames[1:]\n\nprint(\"UX columns: %s\" % sortedcolnames)\nprint(\"Hub DDL   : %s\" % outddl)\n\ncontext.updateVariable('prvt_bkddl', outddl)\ncontext.updateVariable('prvt_sortedcolnames', sortedcolnames)\n\n# Update prvt_valid_clause to the validity clause\n# -----------------------------------------------\noutddl = '1 = \"__deduplicator\"'\n\nfor c in bkcols:\n  outddl = outddl + \" AND \" + c + \" IS NOT NULL\"\n\nprint(outddl)\n\ncontext.updateVariable('prvt_valid_clause', outddl)\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true,"status":{},"columnNames":[]},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4398":{"id":4398,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":272,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4404],"outputSuccessConnectorIDs":[4407],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Satellite DDL"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${jv_database}\".\"${jv_schema}\".\"s_${jv_table_name_stub}\"\n(\n\t\"hashkey\"             VARCHAR(64)   NOT NULL,\n\t\"load_timestamp\"      TIMESTAMP_NTZ NOT NULL,\n\t\"record_source\"       VARCHAR(64)   NOT NULL,\n\t\"latest_from_source\"  BOOLEAN       NOT NULL,\n\t\"hashdiff\"            VARCHAR(64)   NOT NULL,\n\t\"context\"             OBJECT            NULL,\n  CONSTRAINT bk_h_dummy UNIQUE (\"hashkey\", \"load_timestamp\")\n)"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4399":{"id":4399,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":368,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4407],"outputSuccessConnectorIDs":[4405],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Error DDL"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${jv_database}\".\"${jv_schema}\".\"e_${jv_table_name_stub}\"\n(\n\t\"load_timestamp\"      TIMESTAMP_NTZ NOT NULL,\n\t\"record_source\"       VARCHAR(64)   NOT NULL,\n\t\"context\"             OBJECT            NULL\n)"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4400":{"id":4400,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":544,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4405],"outputSuccessConnectorIDs":[4403],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTI DML"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT ALL\nWHEN ${prvt_valid_clause}\n     AND 0 = (SELECT COUNT(*)        \n              FROM \"${jv_database}\".\"${jv_schema}\".\"h_${jv_table_name_stub}\" h\n              WHERE h.\"hashkey\" = \"newhashkey\")\n     THEN INTO \"${jv_database}\".\"${jv_schema}\".\"h_${jv_table_name_stub}\"\n                     (\"hashkey\", ${prvt_sortedcolnames}, \"load_timestamp\", \"record_source\")\n               VALUES(\"newhashkey\",\n                      ${prvt_sortedcolnames},\n                      current_timestamp,\n                      '${jv_record_source}')\nWHEN ${prvt_valid_clause}\n     AND 0 = (SELECT COUNT(*)        \n              FROM \"${jv_database}\".\"${jv_schema}\".\"s_${jv_table_name_stub}\" s\n              WHERE s.\"hashkey\" = \"newhashkey\"\n              AND   s.\"record_source\" = '${jv_record_source}'\n              AND   s.\"latest_from_source\" = TRUE\n              AND   s.\"hashdiff\" = MD5(TO_JSON(\"__obj\"))\n             )\n     THEN INTO \"${jv_database}\".\"${jv_schema}\".\"s_${jv_table_name_stub}\"\n                     (\"hashkey\", \"load_timestamp\", \"record_source\", \"latest_from_source\", \"hashdiff\", \"context\")\n               VALUES(\"newhashkey\",\n                      current_timestamp,\n                      '${jv_record_source}',\n                      TRUE,\n                      MD5(TO_JSON(\"__obj\")),\n                      \"__obj\")\nWHEN NOT (${prvt_valid_clause})\n     THEN INTO \"${jv_database}\".\"${jv_schema}\".\"e_${jv_table_name_stub}\"\n                     (\"load_timestamp\", \"record_source\", \"context\")\n               VALUES(current_timestamp, '${jv_record_source}', OBJECT_CONSTRUCT(*))\nSELECT ${prvt_sortedcolnames},\n       \"${jv_database}\".\"${jv_schema}\".\"f_dv2_hash\"(array_construct(${prvt_sortedcolnames})) AS \"newhashkey\",\n       OBJECT_CONSTRUCT(*) AS \"__obj\",\n       ROW_NUMBER() OVER (PARTITION BY ${prvt_sortedcolnames} ORDER BY 1) AS \"__deduplicator\"\nFROM \"${jv_database}\".\"${jv_schema}\".\"${jv_staging_view_name}\" AS \"src\""}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4401":{"id":4401,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":-368,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4410],"outputSuccessConnectorIDs":[4408],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Log params"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"env | grep \"^jv_\" | sort\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4402":{"id":4402,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":736,"y":-16,"width":32,"height":32,"inputConnectorIDs":[4403],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sat currency"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE \"${jv_database}\".\"${jv_schema}\".\"s_${jv_table_name_stub}\" s1\nSET s1.\"latest_from_source\" = s2.\"is_latest\"\nFROM (SELECT \"hashkey\",\n             \"record_source\",\n             \"hashdiff\",\n             \"load_timestamp\",\n             CASE ROW_NUMBER() OVER (PARTITION BY \"hashkey\", \"record_source\" ORDER BY \"load_timestamp\" DESC)\n             WHEN 1 THEN TRUE\n                    ELSE FALSE\n             END AS \"is_latest\"\n      FROM \"${jv_database}\".\"${jv_schema}\".\"s_${jv_table_name_stub}\") s2\nWHERE          s1.\"hashkey\"  = s2.\"hashkey\"\nAND      s1.\"record_source\"  = s2.\"record_source\"\nAND           s1.\"hashdiff\"  = s2.\"hashdiff\"\nAND     s1.\"load_timestamp\"  = s2.\"load_timestamp\"\nAND s1.\"latest_from_source\" != s2.\"is_latest\""}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10510":{"id":10510,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":64,"y":-16,"width":32,"height":32,"inputConnectorIDs":[10511],"outputSuccessConnectorIDs":[10515],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"f_dv2_hash"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE OR REPLACE FUNCTION \"${jv_database}\".\"${jv_schema}\".\"f_dv2_hash\"(ids array)\nRETURNS varchar\nAS $$\n   MD5(ARRAY_TO_STRING(ids, ','))\n$$\n;\n"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"4403":{"id":4403,"sourceID":4400,"targetID":4402},"4404":{"id":4404,"sourceID":4396,"targetID":4398},"4405":{"id":4405,"sourceID":4399,"targetID":4400},"4406":{"id":4406,"sourceID":4351,"targetID":4397},"4407":{"id":4407,"sourceID":4398,"targetID":4399},"4408":{"id":4408,"sourceID":4401,"targetID":4351},"10511":{"id":10511,"sourceID":4397,"targetID":10510},"10515":{"id":10515,"sourceID":10510,"targetID":4396}},"failureConnectors":{},"unconditionalConnectors":{"4410":{"id":4410,"sourceID":4395,"targetID":4401}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1636036193621,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"4391":{"id":4391,"x":-367,"y":-325,"width":620,"height":188,"text":"This job takes data from a staging view (or table) and populates a Data Vault 2.0 Hub, Satellite and Error table.\n\nScalar Inputs:\n**jv_database** Database Name\n**jv_schema** Schema Name\n**jv_record_source** Name of source system\n**jv_table_name_stub** Stub name of Hub (e.g. \"dummy\" --> h_dummy, s_dummy and e_dummy)\n**jv_staging_view_name** Name of the staging view (or table)\n\nGrid Inputs:\n**gv_business_key** - List of business key columns","colour":"00ce4f"},"4392":{"id":4392,"x":475,"y":-94,"width":133,"height":154,"text":"Load the Hub, Satellite and Error table with a MTI","colour":"00ce4f"},"4393":{"id":4393,"x":673,"y":-94,"width":133,"height":154,"text":"Update non-current Satellite records","colour":"00ce4f"},"4394":{"id":4394,"x":16,"y":-92,"width":388,"height":154,"text":"DDL if needed","colour":"00ce4f"}},"variables":{"jv_schema":{"definition":{"name":"jv_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_bkddl":{"definition":{"name":"prvt_bkddl","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_database":{"definition":{"name":"jv_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"jv_record_source":{"definition":{"name":"jv_record_source","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_valid_clause":{"definition":{"name":"prvt_valid_clause","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_table_name_stub":{"definition":{"name":"jv_table_name_stub","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_sortedcolnames":{"definition":{"name":"prvt_sortedcolnames","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_staging_view_name":{"definition":{"name":"jv_staging_view_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_selected_colnames":{"definition":{"name":"prvt_selected_colnames","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null}},"grids":{"gv_viewcolumns":{"definition":{"name":"gv_viewcolumns","scope":"BRANCH","definitions":[{"name":"colname","type":"TEXT"}],"description":"","visibility":"PRIVATE"},"values":[]},"gv_business_key":{"definition":{"name":"gv_business_key","scope":"BRANCH","definitions":[{"name":"name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}}},"transformationJobs":{}},{"metadata":{"identifier":{"packageName":"matillionexamples","name":"Stage to Link","revision":1,"type":"DYNAMIC"},"rootJobReference":{"name":"Stage to EDW - Link","type":"ORCHESTRATION","parameterMetadata":[{"slot":2,"variableName":"jv_schema","variableType":"SCALAR","displayName":"Schema","description":"The Schema Name","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":3,"variableName":"jv_database","variableType":"SCALAR","displayName":"Database","description":"The Database Name","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":4,"variableName":"jv_link_suffix","variableType":"SCALAR","displayName":"Link name suffix","description":"Optionally added to the link table name to distinguish multiple links between the same hubs","defaultValue":[{"values":{"1":"link"}}],"defaultValueType":"TEXT","required":true},{"slot":5,"variableName":"jv_record_source","variableType":"SCALAR","displayName":"Record Source","description":"Name of source system","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":6,"variableName":"jv_staging_view_name","variableType":"SCALAR","displayName":"Staging object name","description":"Name of the staging view or table","defaultValue":[{"values":{"1":""}}],"defaultValueType":"TEXT","required":true},{"slot":7,"variableName":"gv_hubs_to_link","variableType":"GRID","displayName":"Hubs to link","description":"The list of the Hub tables to be linked\nhubname is the stub only, and is not double-quoted","defaultValue":[{"values":{"1":""}}],"defaultValueType":null,"required":true}]},"orchestrationJobs":["Stage to EDW - Link"],"transformationJobs":[],"imageMetadata":{"componentIcon":"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACwUlEQVR42u2WT0gUURzHl7yUl/BYB6ECieyPJgkp0d9NLNdatnnzJ5AtCfaiQWYFgS4FFpWHJIqQiiSpS5fskBfL1lVqs0TJJLaWEK3UFtrd2XFnZv32ZoxxV9upg0KH+cHnML/He7/v773f+72x2SyzzDLLfhvHcSUszzazPGkxg3DkgiC41qbOdbvdy+lYK2WCEjZFIF8IT+rSglMHoYNq9REnTjoOZKSWUkVc4HgyxbJsniFeILd4geDmRTvam3eZ0nSuHDQWWIGtMgRQx2CjfQ/krCzAZjMlnL0C1a7D2iKtKfO/XveWIdq9IZ2ebYj1FKf5IpQajz7/ydz204zaCwuMIDN+H+TAq4wiGvfvBcsxHSkCpNtN+4wg4kAVFPEjklB0lHgI8SGPMX6mtlIT0JVRQDIURGJsNLMAu4mAlwVQ5Umo0+OQgpcgfboCVQlDVaOI9pYuvYBI726atQr5RxcVs0X3SR/qkRh/hNjr8sUToBcizzyfhSTnjiAfcmRQF6HthDzxFNLIWUR9hYt8BFolp5BaA7G+HTTjh1TAlC5EQxGDiPpLFlXACM2+YRaiGAJ8RRDfHELMv50ewSaI/QwSk526CCl4eelrID58Sg82PXrH2JH48GndF//c8u8CVFlCsj+QBvLy/n4LfFv1a6ddPznsh0yz126AmhQRC1T8WQD9mGwrKpzrA9euYub+vQUgN1cfP19mT2sk8/tArG8npsceQIm8gxIdQuJ7B8S3bOYipB/PPM5KDKxehVBOjind69ZA4BjQN6ExZf77hroK/HyRv7AbzuNb52ZUH3NprbjNEMDzrvV0kdD8ys4EPTIfwzArDQG0r1P/jOeEE/U1laYcd7u0NSRGYIrTHiSHw5HN84yd4xinGeQoKfV6vcsWvqbMQbrwXVobj80gArlBH7KN1v+HZZZZ9t/YLweN3ou/dmNGAAAAAElFTkSuQmCC","smallIcon":"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABWUlEQVR42mNgGAUMoaGhotHhIRtSA31PIuOoyLAlvr6+XJGRwRqZqQEPG0q8vyHj1KTAq0C9EgzhkeEFx+Vk//83NPz/z9jo/38GBjDeoqn+PywyLDg8MrTiyCKL/5+Pmv//ca8XiPv+fzlm9X/TNFuQfAwDkCi7JCnx/19+3v8/xYVwA/YrK4IURIZFhNUcWwzU/GDa/x8Pp/3/fqcNiDv+b51hA5KPx2tAeGTYKyB+BzLg6/nI/3++3f//+8PJ/18vxBBnAND2pvCI8DkgA77frPn/5bT3/29Xsv//encE1YCLIAOio/7/PXTg/7/tW///y8n+v09ZCcULXy/E///98SwQn/n/7VohwoDw6HCLaneX77NNjf8j4xIvjw+hMaEqQEW+3TXu/7dMt0HBjaVef0OjQs3AURkZGSkSHh6uiYyBUcQPi+qIiAgroEFhyBio2WA0E0AAAB0ACwWgIU44AAAAAElFTkSuQmCC"},"description":"Takes data from a staging view (or table) and populates a Data Vault 2.0 Link, Satellite and Error table","helpHtml":"<div class=\"mtln\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACwUlEQVR42u2WT0gUURzHl7yUl/BYB6ECieyPJgkp0d9NLNdatnnzJ5AtCfaiQWYFgS4FFpWHJIqQiiSpS5fskBfL1lVqs0TJJLaWEK3UFtrd2XFnZv32ZoxxV9upg0KH+cHnML/He7/v773f+72x2SyzzDLLfhvHcSUszzazPGkxg3DkgiC41qbOdbvdy+lYK2WCEjZFIF8IT+rSglMHoYNq9REnTjoOZKSWUkVc4HgyxbJsniFeILd4geDmRTvam3eZ0nSuHDQWWIGtMgRQx2CjfQ/krCzAZjMlnL0C1a7D2iKtKfO/XveWIdq9IZ2ebYj1FKf5IpQajz7/ydz204zaCwuMIDN+H+TAq4wiGvfvBcsxHSkCpNtN+4wg4kAVFPEjklB0lHgI8SGPMX6mtlIT0JVRQDIURGJsNLMAu4mAlwVQ5Umo0+OQgpcgfboCVQlDVaOI9pYuvYBI726atQr5RxcVs0X3SR/qkRh/hNjr8sUToBcizzyfhSTnjiAfcmRQF6HthDzxFNLIWUR9hYt8BFolp5BaA7G+HTTjh1TAlC5EQxGDiPpLFlXACM2+YRaiGAJ8RRDfHELMv50ewSaI/QwSk526CCl4eelrID58Sg82PXrH2JH48GndF//c8u8CVFlCsj+QBvLy/n4LfFv1a6ddPznsh0yz126AmhQRC1T8WQD9mGwrKpzrA9euYub+vQUgN1cfP19mT2sk8/tArG8npsceQIm8gxIdQuJ7B8S3bOYipB/PPM5KDKxehVBOjind69ZA4BjQN6ExZf77hroK/HyRv7AbzuNb52ZUH3NprbjNEMDzrvV0kdD8ys4EPTIfwzArDQG0r1P/jOeEE/U1laYcd7u0NSRGYIrTHiSHw5HN84yd4xinGeQoKfV6vcsWvqbMQbrwXVobj80gArlBH7KN1v+HZZZZ9t/YLweN3ou/dmNGAAAAAElFTkSuQmCC\"><h3>Stage to Link</h3><p style='white-space: pre-line; word-wrap: break-word;'>Takes data from a staging view (or table) and populates a Data Vault 2.0 Link, Satellite and Error table</p><h3>Properties</h3><table><tbody><tr><th>Property</th><th>Type</th><th>Description</th></tr><tr><td>Schema</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>The Schema Name</td></tr><tr><td>Database</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>The Database Name</td></tr><tr><td>Link name suffix</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>Optionally added to the link table name to distinguish multiple links between the same hubs</td></tr><tr><td>Record Source</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>Name of source system</td></tr><tr><td>Staging object name</td><td>Variable</td><td style='white-space: pre-line; word-wrap: break-word;'>Name of the staging view or table</td></tr><tr><td>Hubs to link</td><td>Grid</td><td style='white-space: pre-line; word-wrap: break-word;'>The list of the Hub tables to be linked\nhubname is the stub only, and is not double-quoted</td></tr></tbody></table></div>","created":1636037251041},"orchestrationJobs":{"Stage to EDW - Link":{"id":-2,"revision":13,"created":1636037110632,"timestamp":1636037110632,"components":{"4436":{"id":4436,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-512,"y":32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[4486],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4437":{"id":4437,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":-400,"y":32,"width":32,"height":32,"inputConnectorIDs":[4486],"outputSuccessConnectorIDs":[4483],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Log params"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"env | grep \"^jv_\" | sort\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4438":{"id":4438,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":356330947,"x":-288,"y":32,"width":32,"height":32,"inputConnectorIDs":[4483],"outputSuccessConnectorIDs":[4450],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Staging Metadata"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${jv_database}"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${jv_schema}"}}}},"visible":true,"status":{},"columnNames":[]},"5":{"slot":5,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"prvt_gv_viewcolumns"}}}},"visible":true,"status":{},"columnNames":[]},"6":{"slot":6,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Name"}}}},"visible":true,"status":{},"columnNames":[]},"7":{"slot":7,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${jv_staging_view_name}"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4439":{"id":4439,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":416,"y":32,"width":32,"height":32,"inputConnectorIDs":[4485],"outputSuccessConnectorIDs":[4480],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Satellite DDL"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${jv_database}\".\"${jv_schema}\".\"s_${prvt_link_stub}\"\n(\n\t\"hashkey\"             VARCHAR(64) NOT NULL,\n\t\"load_timestamp\"      TIMESTAMP_NTZ NOT NULL,\n\t\"record_source\"       VARCHAR(64) NOT NULL,\n\t\"latest_from_source\"  BOOLEAN NOT NULL,\n\t\"hashdiff\"            VARCHAR(64) NOT NULL,\n\t\"context\"             OBJECT NULL,\n  CONSTRAINT bk_h_dummy UNIQUE (\"hashkey\", \"load_timestamp\")\n)"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4440":{"id":4440,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":320,"y":32,"width":32,"height":32,"inputConnectorIDs":[10527],"outputSuccessConnectorIDs":[4485],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Link DDL"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${jv_database}\".\"${jv_schema}\".\"l_${prvt_link_stub}\"\n(\n\t\"hashkey\" VARCHAR(64) NOT NULL UNIQUE,\n    ${prvt_fkddl}\n\t\"load_timestamp\"      TIMESTAMP_NTZ NOT NULL,\n\t\"record_source\"       VARCHAR(64) NOT NULL,\n  CONSTRAINT bk_h_dummy UNIQUE (${prvt_uxcols})\n)"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4441":{"id":4441,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1155583855,"x":-32,"y":32,"width":32,"height":32,"inputConnectorIDs":[4481],"outputSuccessConnectorIDs":[4449],"outputFailureConnectorIDs":[4487],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get UX"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false,"status":{},"columnNames":[]},"4":{"slot":4,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false,"status":{},"columnNames":[]},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false,"status":{},"columnNames":[]},"7":{"slot":7,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${prvt_ux_query}"}}}},"visible":true,"status":{},"columnNames":[]},"8":{"slot":8,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"prvt_gv_hubcolumns"}}}},"visible":true,"status":{},"columnNames":[]},"9":{"slot":9,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"HUBNAME"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"UXLIST"}}}},"visible":true,"status":{},"columnNames":[]},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false,"status":{},"columnNames":[]},"11":{"slot":11,"name":"Order By","elements":{},"visible":false,"status":{},"columnNames":[]},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false,"status":{},"columnNames":[]},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false,"status":{},"columnNames":[]},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false,"status":{},"columnNames":[]},"20":{"slot":20,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4442":{"id":4442,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-160,"y":32,"width":32,"height":32,"inputConnectorIDs":[4450],"outputSuccessConnectorIDs":[4481],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Metadata pass 1"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# Scalar variables\n# **prvt_link_stub** Stub name for generated tables\n# **prvt_fkddl** the DDL for the Link FK columns\n# **prvt_uxcols** the unique column list for the link DDL\n# **prvt_hashkey_dml** The SQL for the main hash key\n#\n# Grid variables\n# **prvt_gv_hubcolumns** The columns in every Hub table which make up the unique key\n# **prvt_gv_viewcolumns** The columns in the Staging View\n\n# Display the column names in the staging view\nvclist=\"\"\n\nfor c in context.getGridVariable('prvt_gv_viewcolumns'):\n  vclist = vclist + \",\" + c[0]\n\nprint(\"Columns in source view: %s\" % vclist[1:])\n\n# Set prvt_link_stub and prvt_ux_query\n\nlink_stub = 'l'\nux_query = \"SELECT 'x'::VARCHAR(128) AS hubname, 'x'::VARCHAR(1024) AS uxlist WHERE 1=2\"\n\nharr = [x[0].strip().strip('\"') for x in context.getGridVariable('gv_hubs_to_link')]\n\nfor h in sorted(harr):\n  link_stub = link_stub + \"_\" + h\n  ux_query  = ux_query + \"\\nUNION ALL SELECT 'h_\" + h + \"' AS hub, REGEXP_SUBSTR(GET_DDL('TABLE', '\\\"\" + jv_database + \"\\\".\\\"\" + jv_schema + \"\\\".\\\"h_\" + h + \"\\\"'), 'constraint\\\\\\\\s+\\\\\\\\w+\\\\\\\\s+unique\\\\\\\\s+[(](.*)[)]', 1, 1, 'mi', 1)\"\n\nlink_stub = link_stub[2:] + \"_\" + jv_link_suffix\n\nprint(\"Link table name  : l_%s\" % link_stub)\nprint(\"Sat table name   : s_%s\" % link_stub)\nprint(\"Error table name : e_%s\" % link_stub)\n\nprint(\"Metadata query : %s\" % ux_query)\n\ncontext.updateVariable('prvt_link_stub', link_stub)\ncontext.updateVariable('prvt_ux_query', ux_query)\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true,"status":{},"columnNames":[]},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4443":{"id":4443,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":96,"y":32,"width":32,"height":32,"inputConnectorIDs":[4449],"outputSuccessConnectorIDs":[10523],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Metadata pass 2"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# Generate the DDL and DML clauses\n\nfkddl = \"\"\nuxcols = \"\"\nuxexpr = \"\"\nhashkey_dml='\"' + jv_database + '\".\"' + jv_schema + '\".\"f_dv2_hash\"(array_construct('\nvalid_clause = '1 = \"__deduplicator\"'\nfullbk = \"\"\nsatobj_arr = []\nsatobj_expr = \"\"\n\n# Set up the array of column names\n# The business keys of all the hubs will be removed later, leaving only the attributes\nfor c in context.getGridVariable('prvt_gv_viewcolumns'):\n  satobj_arr.append(c[0])\n\n# These are all the UX columns for all the Hub tables being joined\naa = context.getGridVariable('prvt_gv_hubcolumns')\n\n# Log the hubs and their unique key columns\nfor h in sorted(context.getGridVariable('gv_hubs_to_link')):\n  vux = None\n  for r in aa:\n    if(\"h_\" + h[0] == r[0]):\n      vux = r[1]\n      print(\"Unique key of h_%s is %s\" % (h[0], vux))\n  if None == vux:\n    xstr = \"Error: table h_%s does not exist or has no unique key defined\" % h[0]\n    raise Exception(xstr)\n\n\nfor h in sorted(context.getGridVariable('gv_hubs_to_link')):\n  print(\"Adding FK to h_%s\" % h[0])\n  fkddl = fkddl + '\"' + h[0] + '_hashkey\" VARCHAR(64) NOT NULL,'\n  uxcols = uxcols + ',\"' + h[0] + '_hashkey\"'\n  colxpr = \"\"\n  for r in aa:\n    if(\"h_\" + h[0] == r[0]):\n      bkcols = sorted([x.strip() for x in r[1].split(',')])\n      print(\"PK columns: %s\" % bkcols)\n      for c in bkcols:\n        hashkey_dml = hashkey_dml + c + \",\"\n        colxpr = colxpr + ',' + c\n        valid_clause = valid_clause + \" AND \" + c + \" IS NOT NULL\"\n        fullbk = fullbk + \",\" + c\n        # If the removal fails with a ValueError then one of the UX columns was not in the column list, which should not happen\n        satobj_arr.remove(c.replace('\"', ''))\n  uxexpr = uxexpr + '\"' + jv_database + '\".\"' + jv_schema + '\".\"f_dv2_hash\"(array_construct(%s)) AS \"%s_hashkey\",' % (colxpr[1:], h[0])\n\nhashkey_dml = hashkey_dml[:-1] + \"))\"\nuxcols = uxcols[1:]\nfullbk = fullbk[1:]\n\nnewhashkey = '\"' + jv_database + '\".\"' + jv_schema + '\".\"f_dv2_hash\"(array_construct(%s))' % fullbk\n\nfor s in satobj_arr:\n  satobj_expr = satobj_expr + ',' + \"\"\"'%s', \"%s\" \"\"\" % (s,s)\n\nsatobj_expr = satobj_expr[1:]\n\nprint(\"Link FK DDL: %s\" % fkddl)\nprint(\"UX columns: %s\" % uxcols)\nprint(\"UX expression: %s\" % uxexpr)\nprint(\"Hashkey DML: %s\" % hashkey_dml)\nprint(\"Validity clause: %s\" % valid_clause)\nprint(\"Full BK: %s\" % fullbk)\nprint(\"Full hx: %s\" % newhashkey)\nprint(\"Sat Obj expr: %s\" % satobj_expr)\n\ncontext.updateVariable('prvt_fkddl', fkddl)\ncontext.updateVariable('prvt_uxcols', uxcols)\ncontext.updateVariable('prvt_uxexpr', uxexpr)\ncontext.updateVariable('prvt_hashkey_dml', hashkey_dml)\ncontext.updateVariable('prvt_valid_clause', valid_clause)\ncontext.updateVariable('prvt_fullbk', fullbk)\ncontext.updateVariable('prvt_newhashkey', newhashkey)\ncontext.updateVariable('prvt_satobj_expr', satobj_expr)\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true,"status":{},"columnNames":[]},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4444":{"id":4444,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":656,"y":32,"width":32,"height":32,"inputConnectorIDs":[4482],"outputSuccessConnectorIDs":[4484],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTI DML"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT ALL\nWHEN ${prvt_valid_clause}\n    AND 0 = (SELECT COUNT(*)        \n              FROM \"${jv_database}\".\"${jv_schema}\".\"l_${prvt_link_stub}\" l\n              WHERE l.\"hashkey\" = \"newhashkey\")\n    THEN INTO \"${jv_database}\".\"${jv_schema}\".\"l_${prvt_link_stub}\"\n              (\"hashkey\", ${prvt_uxcols}, \"load_timestamp\", \"record_source\")\n       VALUES (\"newhashkey\", ${prvt_uxcols}, current_timestamp, '${jv_record_source}')\nWHEN ${prvt_valid_clause}\n    AND 0 = (SELECT COUNT(*)        \n              FROM \"${jv_database}\".\"${jv_schema}\".\"s_${prvt_link_stub}\" s\n              WHERE s.\"hashkey\" = \"newhashkey\"\n              AND   s.\"record_source\" = '${jv_record_source}'\n              AND   s.\"latest_from_source\" = TRUE\n              AND   s.\"hashdiff\" = MD5(TO_JSON(\"__obj\")))\n    THEN INTO \"${jv_database}\".\"${jv_schema}\".\"s_${prvt_link_stub}\"\n              (\"hashkey\", \"load_timestamp\", \"record_source\", \"latest_from_source\", \"hashdiff\", \"context\")\n       VALUES (\"newhashkey\",\n               current_timestamp,\n               '${jv_record_source}',\n               TRUE,\n               MD5(TO_JSON(\"__obj\")),\n               \"__obj\")\nWHEN NOT(${prvt_valid_clause})\n    THEN INTO \"${jv_database}\".\"${jv_schema}\".\"e_${prvt_link_stub}\"\n              (\"load_timestamp\", \"record_source\", \"context\")\n       VALUES (current_timestamp, '${jv_record_source}', \"__obj\")\nSELECT ${prvt_fullbk},\n       ${prvt_newhashkey} AS \"newhashkey\",\n       ${prvt_uxexpr}\n       OBJECT_CONSTRUCT(${prvt_satobj_expr}) AS \"__obj\",\n       ROW_NUMBER() OVER (PARTITION BY ${prvt_fullbk} ORDER BY 1) AS \"__deduplicator\"\nFROM \"${jv_database}\".\"${jv_schema}\".\"${jv_staging_view_name}\" AS \"src\""}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4445":{"id":4445,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":512,"y":32,"width":32,"height":32,"inputConnectorIDs":[4480],"outputSuccessConnectorIDs":[4482],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Error DDL"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${jv_database}\".\"${jv_schema}\".\"e_${prvt_link_stub}\"\n(\n\t\"load_timestamp\"      TIMESTAMP_NTZ NOT NULL,\n\t\"record_source\"       VARCHAR(64) NOT NULL,\n\t\"context\"             OBJECT NULL\n)"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4446":{"id":4446,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-32,"y":144,"width":32,"height":32,"inputConnectorIDs":[4487],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Hub not found error"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# The tables don't exist or not privileged\n\nraise Exception(\"Failed to get Snowflake definition for Hub tables: \" + (\", \".join([\"h_\" + x[0] for x in context.getGridVariable('gv_hubs_to_link')])))\n"}}}},"visible":true,"status":{},"columnNames":[]},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true,"status":{},"columnNames":[]},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"4447":{"id":4447,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":848,"y":32,"width":32,"height":32,"inputConnectorIDs":[4484],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sat currency"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UPDATE \"${jv_database}\".\"${jv_schema}\".\"s_${prvt_link_stub}\" s1\nSET s1.\"latest_from_source\" = s2.\"is_latest\"\nFROM (SELECT \"hashkey\",\n             \"record_source\",\n             \"hashdiff\",\n             \"load_timestamp\",\n             CASE ROW_NUMBER() OVER (PARTITION BY \"hashkey\", \"record_source\" ORDER BY \"load_timestamp\" DESC)\n             WHEN 1 THEN TRUE\n                    ELSE FALSE\n             END AS \"is_latest\"\n      FROM \"${jv_database}\".\"${jv_schema}\".\"s_${prvt_link_stub}\") s2\nWHERE          s1.\"hashkey\"  = s2.\"hashkey\"\nAND      s1.\"record_source\"  = s2.\"record_source\"\nAND           s1.\"hashdiff\"  = s2.\"hashdiff\"\nAND     s1.\"load_timestamp\"  = s2.\"load_timestamp\"\nAND s1.\"latest_from_source\" != s2.\"is_latest\""}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10522":{"id":10522,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":32,"width":32,"height":32,"inputConnectorIDs":[10523],"outputSuccessConnectorIDs":[10527],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"f_dv2_hash"}}}},"visible":true,"status":{},"columnNames":[]},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE OR REPLACE FUNCTION \"${jv_database}\".\"${jv_schema}\".\"f_dv2_hash\"(ids array)\nRETURNS varchar\nAS $$\n   MD5(ARRAY_TO_STRING(ids, ','))\n$$\n;\n"}}}},"visible":true,"status":{},"columnNames":[]}},"validationStatus":{},"status":{},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"4449":{"id":4449,"sourceID":4441,"targetID":4443},"4450":{"id":4450,"sourceID":4438,"targetID":4442},"4480":{"id":4480,"sourceID":4439,"targetID":4445},"4481":{"id":4481,"sourceID":4442,"targetID":4441},"4482":{"id":4482,"sourceID":4445,"targetID":4444},"4483":{"id":4483,"sourceID":4437,"targetID":4438},"4484":{"id":4484,"sourceID":4444,"targetID":4447},"4485":{"id":4485,"sourceID":4440,"targetID":4439},"10523":{"id":10523,"sourceID":4443,"targetID":10522},"10527":{"id":10527,"sourceID":10522,"targetID":4440}},"failureConnectors":{"4487":{"id":4487,"sourceID":4441,"targetID":4446}},"unconditionalConnectors":{"4486":{"id":4486,"sourceID":4436,"targetID":4437}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Move Components","undoCreated":1636036210507,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"4432":{"id":4432,"x":-531,"y":-260,"width":680,"height":186,"text":"This job takes data from a staging view (or table) and populates a Data Vault 2.0 Link, Satellite and Error table.\n\nScalar Inputs:\n**jv_database** Database Name\n**jv_link_suffix** Added to the link table name to distinguish multiple links between the same hubs (default __link__)\n**jv_record_source** Name of source system\n**jv_schema** Schema Name\n**jv_staging_view_name** Name of a view (or table) which contains the link data in the staging area\n\nGrid Inputs:\n**gv_hubs_to_link** The stub names of all the Hub tables being linked\n\n","colour":"00ce4f"},"4433":{"id":4433,"x":601,"y":-45,"width":133,"height":154,"text":"Load the Hub, Satellite and Error table with a MTI","colour":"00ce4f"},"4434":{"id":4434,"x":175,"y":-45,"width":377,"height":155,"text":"DDL if needed","colour":"00ce4f"},"4435":{"id":4435,"x":778,"y":-45,"width":133,"height":154,"text":"Update non-current Satellite records","colour":"00ce4f"}},"variables":{"prvt_hub":{"definition":{"name":"prvt_hub","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_schema":{"definition":{"name":"jv_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_fkddl":{"definition":{"name":"prvt_fkddl","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_database":{"definition":{"name":"jv_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_fullbk":{"definition":{"name":"prvt_fullbk","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"prvt_uxcols":{"definition":{"name":"prvt_uxcols","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"prvt_uxexpr":{"definition":{"name":"prvt_uxexpr","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"prvt_ux_query":{"definition":{"name":"prvt_ux_query","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_link_suffix":{"definition":{"name":"jv_link_suffix","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"link"},"prvt_link_stub":{"definition":{"name":"prvt_link_stub","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"prvt_newhashkey":{"definition":{"name":"prvt_newhashkey","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_record_source":{"definition":{"name":"jv_record_source","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_hashkey_dml":{"definition":{"name":"prvt_hashkey_dml","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"prvt_satobj_expr":{"definition":{"name":"prvt_satobj_expr","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"prvt_valid_clause":{"definition":{"name":"prvt_valid_clause","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null},"jv_staging_view_name":{"definition":{"name":"jv_staging_view_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"prvt_selected_colnames":{"definition":{"name":"prvt_selected_colnames","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":null}},"grids":{"gv_hubs_to_link":{"definition":{"name":"gv_hubs_to_link","scope":"BRANCH","definitions":[{"name":"hubname","type":"TEXT"}],"description":"The list of the Hub tables to be linked\nhubname is the stub only, and is not double-quoted","visibility":"PUBLIC"},"values":[]},"prvt_gv_hubcolumns":{"definition":{"name":"prvt_gv_hubcolumns","scope":"BRANCH","definitions":[{"name":"hubname","type":"TEXT"},{"name":"colnames","type":"TEXT"}],"description":"The columns in every Hub table which make up the unique key\nThe hubname is not double-quoted\nThe colnames are double-quoted","visibility":"PRIVATE"},"values":[]},"prvt_gv_viewcolumns":{"definition":{"name":"prvt_gv_viewcolumns","scope":"BRANCH","definitions":[{"name":"colname","type":"TEXT"}],"description":"The columns in the Staging View\nThe colname is not double-quoted","visibility":"PRIVATE"},"values":[]}}}},"transformationJobs":{}}],"version":"1.48.3","environment":"snowflake"}